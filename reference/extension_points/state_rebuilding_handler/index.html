
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="How to define state rebuilding logic">
      
      
      
        <link rel="canonical" href="https://docs.opencqrs.com/reference/extension_points/state_rebuilding_handler/">
      
      
        <link rel="prev" href="../command_handler/">
      
      
        <link rel="next" href="../event_handler/">
      
      
      <link rel="icon" href="../../../images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.4">
    
    
      
        <title>Defining State Rebuilding Handlers - OpenCQRS</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="Defining State Rebuilding Handlers - OpenCQRS" >
      
        <meta  property="og:description"  content="How to define state rebuilding logic" >
      
        <meta  property="og:image"  content="https://docs.opencqrs.com/assets/images/social/reference/extension_points/state_rebuilding_handler/index.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://docs.opencqrs.com/reference/extension_points/state_rebuilding_handler/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="Defining State Rebuilding Handlers - OpenCQRS" >
      
        <meta  name="twitter:description"  content="How to define state rebuilding logic" >
      
        <meta  name="twitter:image"  content="https://docs.opencqrs.com/assets/images/social/reference/extension_points/state_rebuilding_handler/index.png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#events-and-write-models" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="https://www.opencqrs.com" title="OpenCQRS" class="md-header__button md-logo" aria-label="OpenCQRS" data-md-component="logo">
      
  <img src="../../../images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OpenCQRS
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Defining State Rebuilding Handlers
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/open-cqrs/opencqrs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  Overview

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../tutorials/" class="md-tabs__link">
          
  
    
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../howto/" class="md-tabs__link">
          
  
    
  
  Guides

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
    
  
  Reference

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../concepts/" class="md-tabs__link">
          
  
    
  
  Concepts

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://www.opencqrs.com" title="OpenCQRS" class="md-nav__button md-logo" aria-label="OpenCQRS" data-md-component="logo">
      
  <img src="../../../images/logo.png" alt="logo">

    </a>
    OpenCQRS
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/open-cqrs/opencqrs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../tutorials/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/01_setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setting up the Environment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/02_command_handling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Handling Commands
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/03_domain_logic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Developing the Domain
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/04_book_reminder/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Handling Events
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/05_catalog_projection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Building Read Models from Events
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/06_testing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Testing the Domain
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
          
        
      
        
          
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../howto/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Guides
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/explicit_type_registration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Registering explicit Event Types
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/upcasting_events/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Upcasting Events
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Modules
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../events/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Event Representations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../exceptions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Exception Handling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../core_components/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Core Components
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            Core Components
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../core_components/esdb_client/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ESDB Client
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../core_components/event_repository/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Event Repository
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../core_components/command_router/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Command Router
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../core_components/event_handling_processor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Event Handling Processor
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Extension Points
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            Extension Points
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../command_handler/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Defining Command Handlers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Defining State Rebuilding Handlers
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Defining State Rebuilding Handlers
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#events-and-write-models" class="md-nav__link">
    <span class="md-ellipsis">
      Events and Write Models
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#state-rebuilding-handler-definitions" class="md-nav__link">
    <span class="md-ellipsis">
      State Rebuilding Handler Definitions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#state-rebuilding-handlers" class="md-nav__link">
    <span class="md-ellipsis">
      State Rebuilding Handlers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#registration" class="md-nav__link">
    <span class="md-ellipsis">
      Registration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Registration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#manual-registration" class="md-nav__link">
    <span class="md-ellipsis">
      Manual Registration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spring-boot-based-registration" class="md-nav__link">
    <span class="md-ellipsis">
      Spring Boot based Registration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Spring Boot based Registration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#state-rebuilding-handler-definition-using-bean-methods" class="md-nav__link">
    <span class="md-ellipsis">
      State Rebuilding Handler Definition using @Bean Methods
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#state-rebuilding-handler-definition-using-annotations" class="md-nav__link">
    <span class="md-ellipsis">
      State Rebuilding Handler Definition using Annotations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../event_handler/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Defining Event Handlers
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
          
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../test_support/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Test Support
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_7" id="__nav_4_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7">
            <span class="md-nav__icon md-icon"></span>
            Test Support
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../test_support/command_handling_test_fixture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Command Handling Tests
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../concepts/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Concepts
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../concepts/events/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Events
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../concepts/event_sourcing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Event Sourcing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../concepts/upcasting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Event Upcasting
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#events-and-write-models" class="md-nav__link">
    <span class="md-ellipsis">
      Events and Write Models
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#state-rebuilding-handler-definitions" class="md-nav__link">
    <span class="md-ellipsis">
      State Rebuilding Handler Definitions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#state-rebuilding-handlers" class="md-nav__link">
    <span class="md-ellipsis">
      State Rebuilding Handlers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#registration" class="md-nav__link">
    <span class="md-ellipsis">
      Registration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Registration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#manual-registration" class="md-nav__link">
    <span class="md-ellipsis">
      Manual Registration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spring-boot-based-registration" class="md-nav__link">
    <span class="md-ellipsis">
      Spring Boot based Registration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Spring Boot based Registration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#state-rebuilding-handler-definition-using-bean-methods" class="md-nav__link">
    <span class="md-ellipsis">
      State Rebuilding Handler Definition using @Bean Methods
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#state-rebuilding-handler-definition-using-annotations" class="md-nav__link">
    <span class="md-ellipsis">
      State Rebuilding Handler Definition using Annotations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>Defining State Rebuilding Handlers</h1>

<p>Within <abbr title="Command Query Responsibility Segregation">CQRS</abbr> applications state rebuilding logic is responsible for 
<a href="../../../concepts/event_sourcing/#reconstructing-the-write-model">reconstructing the write model (state)</a>
in order to be able to <a href="../#command-handling">handle commands</a>, which need to decide if the command
is applicable or not with respect to that state. The <a href="../../core_components/command_router/">command router</a>
therefore always executes all relevant <a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/command/StateRebuildingHandlerDefinition.html" title="com.opencqrs.framework.command.StateRebuildingHandlerDefinition" style="color: inherit;"><code>StateRebuildingHandlerDefinition</code></a>s
based on the <a href="../../events/">sourced events</a> prior to executing the command.</p>
<h2 id="events-and-write-models">Events and Write Models</h2>
<p>Events represent facts or state changes within a <abbr title="Command Query Responsibility Segregation">CQRS</abbr>/<abbr title="Event Sourcing">ES</abbr> application. Accordingly, they can be used to
<a href="../../../concepts/event_sourcing/#reconstructing-the-write-model">reconstruct the state</a> needed to handle a command.
This is referred to as the <em>write model</em> within <abbr title="Command Query Responsibility Segregation">CQRS</abbr> and any Java class (except <code>java.lang.String</code>) may be used to represent it,
as shown in the following <code>Book</code> class, which represents books within a library, their lending status, and any damaged pages:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">Book</span><span class="p">(</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">isbn</span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">        </span><span class="kt">long</span><span class="w"> </span><span class="n">numPages</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">        </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="n">damagedPages</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">        </span><span class="n">Lending</span><span class="w"> </span><span class="n">lending</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">    </span><span class="c1">// ...</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="p">}</span>
</span></code></pre></div>
<div class="admonition question">
<p class="admonition-title">Why is there no <em>Aggregate</em> in OpenCQRS?</p>
<p>The term <em>aggregate</em> was originally coined by <abbr title="Domain Driven Design">DDD</abbr> to refer to the write model, representing the consistency
boundary for state changes, in the context of command execution. This, however, does not imply that the aggregate needs to be
represented by a single class, e.g. <code>Book</code> aggregate for all book related commands. OpenCQRS lets you
choose which class is suited best for representing the write model state for a specific command. For instance, one may
choose to use the <code>Book</code> class for purchasing a book and a <code>Page</code> model class for maintaining its pages' status.</p>
<p>It is up to the <a href="../command_handler/">command handler implementation</a> to decide which write model class suits
its needs best. The only constraint is, that currently only state rebuilding handlers matching this type will be used by
OpenCQRS to reconstruct the state prior to executing the command. Apart from that, any Java class
(except <code>java.lang.String</code>) may be chosen; it does not even have to be serializable, as write model reconstruction
is an in-memory only operation.</p>
</div>
<p>Events may be consumed in two flavors in order to reconstruct the write model:</p>
<ul>
<li>as plain Java object representing an <a href="../../events/#event-payload-and-metadata">event's payload</a></li>
<li>as <em>raw</em> <a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/esdb/client/Event.html" title="com.opencqrs.esdb.client.Event" style="color: inherit;"><code>Event</code></a> if more information is required, such as its <code>id</code> or <code>hash</code></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Raw Event Representations</p>
<p>Events used to reconstruct the write model will always be obtained from the <a href="../../core_components/event_repository/">event repository</a>.
Accordingly, <em>raw event representation</em> in that case refers to an instance of <a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/esdb/client/Event.html" title="com.opencqrs.esdb.client.Event" style="color: inherit;"><code>Event</code></a>, whose
<code>data</code> has already been <a href="../../../concepts/upcasting/">upcasted</a>, to ensure it can be mapped properly to the appropriate Java event class.</p>
</div>
<p>The following is an example of a Java event class representing a previously purchased book:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">BookPurchasedEvent</span><span class="p">(</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">isbn</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">author</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">title</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">        </span><span class="kt">long</span><span class="w"> </span><span class="n">numPages</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
</span></code></pre></div>
<h2 id="state-rebuilding-handler-definitions">State Rebuilding Handler Definitions</h2>
<p>OpenCQRS requires developers to provide <a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/command/StateRebuildingHandlerDefinition.html" title="com.opencqrs.framework.command.StateRebuildingHandlerDefinition" style="color: inherit;"><code>StateRebuildingHandlerDefinition</code></a>s,
encapsulating the state reconstruction logic. These need to be registered with a <a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/command/CommandRouter.html" title="com.opencqrs.framework.command.CommandRouter" style="color: inherit;"><code>CommandRouter</code></a>,
in order to be executed prior to the actual commands. <a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/command/StateRebuildingHandlerDefinition.html" title="com.opencqrs.framework.command.StateRebuildingHandlerDefinition" style="color: inherit;"><code>StateRebuildingHandlerDefinition</code></a> requires 
the following parameters for its construction:</p>
<ol>
<li>A <code>java.lang.Class</code> identifying the type of the write model to be reconstructed.</li>
<li>A <code>java.lang.Class</code> used to identify which type of assignable Java event objects can be applied.</li>
<li>A <a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/command/StateRebuildingHandler.html" title="com.opencqrs.framework.command.StateRebuildingHandler" style="color: inherit;"><code>StateRebuildingHandler</code></a> encapsulating the state reconstruction logic.</li>
</ol>
<p>The <a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/command/CommandRouter.html" title="com.opencqrs.framework.command.CommandRouter" style="color: inherit;"><code>CommandRouter</code></a> upon sourcing the relevant events for the command, takes into account
all registered <a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/command/StateRebuildingHandlerDefinition.html" title="com.opencqrs.framework.command.StateRebuildingHandlerDefinition" style="color: inherit;"><code>StateRebuildingHandlerDefinition</code></a>s matching the required write model type
<strong>and</strong> the assignable event type.</p>
<div class="admonition warning">
<p class="admonition-title">State Reconstruction Constraints</p>
<p>Class inheritance may be leveraged to assign sourced events to <a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/command/StateRebuildingHandlerDefinition.html" title="com.opencqrs.framework.command.StateRebuildingHandlerDefinition" style="color: inherit;"><code>StateRebuildingHandlerDefinition</code></a>s
defined using a more generic Java event type, even <code>java.lang.Object</code>. If multiple <a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/command/StateRebuildingHandlerDefinition.html" title="com.opencqrs.framework.command.StateRebuildingHandlerDefinition" style="color: inherit;"><code>StateRebuildingHandlerDefinition</code></a>s 
are capable of handling the sourced event, all of them are used to reconstruct the write model state, however, <strong>with no specific order</strong>.</p>
</div>
<h2 id="state-rebuilding-handlers">State Rebuilding Handlers</h2>
<p>There are five different types of <a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/command/StateRebuildingHandler.html" title="com.opencqrs.framework.command.StateRebuildingHandler" style="color: inherit;"><code>StateRebuildingHandler</code></a> that may be extended
to define the actual write model reconstruction logic; all of them are functional interfaces:</p>
<ol>
<li><a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/command/StateRebuildingHandler.FromObject.html" title="com.opencqrs.framework.command.StateRebuildingHandler.FromObject" style="color: inherit;"><code>FromObject</code></a> if only the previous write model (or <code>null</code>) and the Java event object is sufficient.</li>
<li><a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/command/StateRebuildingHandler.FromObjectAndMetaData.html" title="com.opencqrs.framework.command.StateRebuildingHandler.FromObjectAndMetaData" style="color: inherit;"><code>FromObjectAndMetaData</code></a> if additional access to the event's meta-data is required.</li>
<li><a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/command/StateRebuildingHandler.FromObjectAndMetaDataAndSubject.html" title="com.opencqrs.framework.command.StateRebuildingHandler.FromObjectAndMetaDataAndSubject" style="color: inherit;"><code>FromObjectAndMetaDataAndSubject</code></a> if additional access to the event's meta-data and subject is required.</li>
<li><a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/command/StateRebuildingHandler.FromObjectAndMetaDataAndSubjectAndRawEvent.html" title="com.opencqrs.framework.command.StateRebuildingHandler.FromObjectAndMetaDataAndSubjectAndRawEvent" style="color: inherit;"><code>FromObjectAndMetaDataAndSubjectAndRawEvent</code></a> if additional access to the event's meta-data, its subject and the raw <a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/esdb/client/Event.html" title="com.opencqrs.esdb.client.Event" style="color: inherit;"><code>Event</code></a> is required.</li>
<li><a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/command/StateRebuildingHandler.FromObjectAndRawEvent.html" title="com.opencqrs.framework.command.StateRebuildingHandler.FromObjectAndRawEvent" style="color: inherit;"><code>FromObjectAndRawEvent</code></a> if additional access to the raw <a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/esdb/client/Event.html" title="com.opencqrs.esdb.client.Event" style="color: inherit;"><code>Event</code></a> is required.</li>
</ol>
<div class="admonition warning">
<p class="admonition-title">Accessing raw <a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/esdb/client/Event.html" title="com.opencqrs.esdb.client.Event" style="color: inherit;"><code>Event</code></a>s</p>
<p>Special care needs to be taken, when accessing raw <a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/esdb/client/Event.html" title="com.opencqrs.esdb.client.Event" style="color: inherit;"><code>Event</code></a>s within <a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/command/StateRebuildingHandler.html" title="com.opencqrs.framework.command.StateRebuildingHandler" style="color: inherit;"><code>StateRebuildingHandler</code></a>s,
since handlers will not only be called prior to command execution, but also <strong>immediately</strong> when publishing new events from within <a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/command/CommandHandler.html" title="com.opencqrs.framework.command.CommandHandler" style="color: inherit;"><code>CommandHandler</code></a>s
using the <a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/command/CommandEventPublisher.html" title="com.opencqrs.framework.command.CommandEventPublisher" style="color: inherit;"><code>CommandEventPublisher</code></a>. At this point in time the event has not yet been written to the
event store, so no <em>raw</em> information, such as the event <code>id</code>, is available. Hence, all raw event references will be <code>null</code> during that execution phase.</p>
</div>
<p>All five types require the developer to specify the following generic types:</p>
<ol>
<li>the type of the write model to be reconstructed</li>
<li>the event type</li>
</ol>
<div class="admonition info">
<p class="admonition-title">Choosing a <a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/command/StateRebuildingHandler.html" title="com.opencqrs.framework.command.StateRebuildingHandler" style="color: inherit;"><code>StateRebuildingHandler</code></a> Type</p>
</div>
<p>The choice of a suitable <a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/command/StateRebuildingHandler.html" title="com.opencqrs.framework.command.StateRebuildingHandler" style="color: inherit;"><code>StateRebuildingHandler</code></a> is for <em>syntactical</em> reasons only, especially
when using Java or Kotlin lambda expressions to implement them. The choice has no effect on the <a href="../#command-handling">reconstruction</a> itself.</p>
<h2 id="registration">Registration</h2>
<p><a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/command/StateRebuildingHandlerDefinition.html" title="com.opencqrs.framework.command.StateRebuildingHandlerDefinition" style="color: inherit;"><code>StateRebuildingHandlerDefinition</code></a>s need to be created and registered with the
<a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/command/CommandRouter.html" title="com.opencqrs.framework.command.CommandRouter" style="color: inherit;"><code>CommandRouter</code></a>, before commands can be executed.</p>
<h3 id="manual-registration">Manual Registration</h3>
<p>A list of <a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/command/StateRebuildingHandlerDefinition.html" title="com.opencqrs.framework.command.StateRebuildingHandlerDefinition" style="color: inherit;"><code>StateRebuildingHandlerDefinition</code></a> can be registered with a
<a href="../../core_components/command_router/#manual-configuration">manually configured</a>
<a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/command/CommandRouter.html" title="com.opencqrs.framework.command.CommandRouter" style="color: inherit;"><code>CommandRouter</code></a> programmatically as in the following example:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">CommandRouter</span><span class="w"> </span><span class="nf">commandRouter</span><span class="p">(</span><span class="n">EventRepository</span><span class="w"> </span><span class="n">eventRepository</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">      </span><span class="n">StateRebuildingHandlerDefinition</span><span class="o">&lt;</span><span class="n">Book</span><span class="p">,</span><span class="w"> </span><span class="n">BookPurchasedEvent</span><span class="o">&gt;</span><span class="w"> </span><span class="n">bookPurchased</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StateRebuildingHandlerDefinition</span><span class="o">&lt;&gt;</span><span class="p">(</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">              </span><span class="n">Book</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">              </span><span class="n">BookPurchasedEvent</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">              </span><span class="p">(</span><span class="n">StateRebuildingHandler</span><span class="p">.</span><span class="na">FromObject</span><span class="o">&lt;</span><span class="n">Book</span><span class="p">,</span><span class="w"> </span><span class="n">BookPurchasedEvent</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">book</span><span class="w"> </span><span class="cm">/* (1)! */</span><span class="p">,</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">                      </span><span class="k">new</span><span class="w"> </span><span class="n">Book</span><span class="p">(</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">                              </span><span class="n">event</span><span class="p">.</span><span class="na">isbn</span><span class="p">(),</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">                              </span><span class="n">event</span><span class="p">.</span><span class="na">numPages</span><span class="p">(),</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">                              </span><span class="n">Set</span><span class="p">.</span><span class="na">of</span><span class="p">(),</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">                              </span><span class="kc">null</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="w">                      </span><span class="p">)</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="w">      </span><span class="p">);</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w">      </span><span class="n">StateRebuildingHandlerDefinition</span><span class="o">&lt;</span><span class="n">Book</span><span class="p">,</span><span class="w"> </span><span class="n">BookBorrowedEvent</span><span class="o">&gt;</span><span class="w"> </span><span class="n">bookBorrowed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StateRebuildingHandlerDefinition</span><span class="o">&lt;&gt;</span><span class="p">(</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="w">              </span><span class="n">Book</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="w">              </span><span class="n">BookBorrowedEvent</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="w">              </span><span class="p">(</span><span class="n">StateRebuildingHandler</span><span class="p">.</span><span class="na">FromObject</span><span class="o">&lt;</span><span class="n">Book</span><span class="p">,</span><span class="w"> </span><span class="n">BookBorrowedEvent</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">book</span><span class="p">,</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="w">                      </span><span class="k">new</span><span class="w"> </span><span class="n">Book</span><span class="p">(</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a><span class="w">                              </span><span class="n">book</span><span class="p">.</span><span class="na">isbn</span><span class="p">(),</span>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a><span class="w">                              </span><span class="n">book</span><span class="p">.</span><span class="na">numPages</span><span class="p">(),</span>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="w">                              </span><span class="n">book</span><span class="p">.</span><span class="na">damagedPages</span><span class="p">(),</span>
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a><span class="w">                              </span><span class="k">new</span><span class="w"> </span><span class="n">Lending</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">dueAt</span><span class="p">())</span><span class="w"> </span><span class="cm">/* (2)! */</span>
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="w">                      </span><span class="p">)</span>
</span><span id="__span-2-24"><a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a><span class="w">      </span><span class="p">);</span>
</span><span id="__span-2-25"><a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a>
</span><span id="__span-2-26"><a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CommandRouter</span><span class="p">(</span>
</span><span id="__span-2-27"><a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a><span class="w">              </span><span class="n">eventRepository</span><span class="p">,</span>
</span><span id="__span-2-28"><a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a><span class="w">              </span><span class="n">eventRepository</span><span class="p">,</span>
</span><span id="__span-2-29"><a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a><span class="w">              </span><span class="n">List</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="cm">/* (3)! */</span><span class="p">),</span>
</span><span id="__span-2-30"><a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a><span class="w">              </span><span class="n">List</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">bookPurchased</span><span class="p">,</span><span class="w"> </span><span class="n">bookBorrowed</span><span class="p">)</span>
</span><span id="__span-2-31"><a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a><span class="w">      </span><span class="p">);</span>
</span><span id="__span-2-32"><a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a><span class="w">    </span><span class="p">}</span>
</span></code></pre></div>
<ol>
<li>Previous <code>book</code> state isn't used in this example, as <code>BookPurchasedEvent</code> represents the initial event, therefore the state is <code>null</code>.</li>
<li>Previous <code>book</code> state is updated by creating a copy including <code>dueAt</code> timestamp.</li>
<li><a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/command/CommandHandlerDefinition.html" title="com.opencqrs.framework.command.CommandHandlerDefinition" style="color: inherit;"><code>CommandHandlerDefinition</code></a>s omitted, <a href="../command_handler/">see</a></li>
</ol>
<h3 id="spring-boot-based-registration">Spring Boot based Registration</h3>
<p>When using the <a href="../../core_components/command_router/#spring-boot-auto-configuration">Spring Boot auto-configured command router</a>
<a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/command/StateRebuildingHandlerDefinition.html" title="com.opencqrs.framework.command.StateRebuildingHandlerDefinition" style="color: inherit;"><code>StateRebuildingHandlerDefinition</code></a>s can be defined as Spring beans, in order to be
auto-wired with the <a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/command/CommandRouter.html" title="com.opencqrs.framework.command.CommandRouter" style="color: inherit;"><code>CommandRouter</code></a> instance created by
the <a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/command/CommandRouterAutoConfiguration.html" title="com.opencqrs.framework.command.CommandRouterAutoConfiguration" style="color: inherit;"><code>CommandRouterAutoConfiguration</code></a>.</p>
<div class="admonition tip">
<p class="admonition-title">Command Handling Test Support</p>
<p>It is recommended to define <a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/command/StateRebuildingHandlerDefinition.html" title="com.opencqrs.framework.command.StateRebuildingHandlerDefinition" style="color: inherit;"><code>StateRebuildingHandlerDefinition</code></a> Spring beans
within classes annotated with <a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/command/CommandHandlerConfiguration.html" title="com.opencqrs.framework.command.CommandHandlerConfiguration" style="color: inherit;"><code>CommandHandlerConfiguration</code></a>, which in turn
is meta-annotated with <code>org.springframework.context.annotation.Configuration</code>. This enables
<a href="../../test_support/command_handling_test_fixture/">command handling tests</a> to automatically detect and load them without
starting a full-blown Spring context, instead using the <a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/command/CommandHandlingTest.html" title="com.opencqrs.framework.command.CommandHandlingTest" style="color: inherit;"><code>CommandHandlingTest</code></a> test
slice.</p>
</div>
<h4 id="state-rebuilding-handler-definition-using-bean-methods">State Rebuilding Handler Definition using @Bean Methods</h4>
<p><a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/command/StateRebuildingHandlerDefinition.html" title="com.opencqrs.framework.command.StateRebuildingHandlerDefinition" style="color: inherit;"><code>StateRebuildingHandlerDefinition</code></a>s can be defined using <code>org.springframework.context.annotation.Bean</code>
annotated methods, as shown in the following example.</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nd">@CommandHandlerConfiguration</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BookHandlers</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">      </span><span class="nd">@Bean</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">      </span><span class="kd">public</span><span class="w"> </span><span class="n">StateRebuildingHandlerDefinition</span><span class="o">&lt;</span><span class="n">Book</span><span class="p">,</span><span class="w"> </span><span class="n">BookPurchasedEvent</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">bookPurchased</span><span class="p">(</span><span class="cm">/* (1)! */</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StateRebuildingHandlerDefinition</span><span class="o">&lt;&gt;</span><span class="p">(</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">                    </span><span class="n">Book</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">                    </span><span class="n">BookPurchasedEvent</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">                    </span><span class="p">(</span><span class="n">StateRebuildingHandler</span><span class="p">.</span><span class="na">FromObject</span><span class="o">&lt;</span><span class="n">Book</span><span class="p">,</span><span class="w"> </span><span class="n">BookPurchasedEvent</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">book</span><span class="p">,</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">                            </span><span class="k">new</span><span class="w"> </span><span class="n">Book</span><span class="p">(</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">                                    </span><span class="n">event</span><span class="p">.</span><span class="na">isbn</span><span class="p">(),</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">                                    </span><span class="n">event</span><span class="p">.</span><span class="na">numPages</span><span class="p">(),</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="w">                                    </span><span class="n">Set</span><span class="p">.</span><span class="na">of</span><span class="p">(),</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="w">                                    </span><span class="kc">null</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="w">                            </span><span class="p">)</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="w">        </span><span class="p">);</span>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a><span class="p">}</span>
</span></code></pre></div>
<ol>
<li>The <a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/command/StateRebuildingHandler.html" title="com.opencqrs.framework.command.StateRebuildingHandler" style="color: inherit;"><code>StateRebuildingHandler</code></a> may access additional auto-wired beans, which can be defined
   as auto-wired dependencies within the <code>@Bean</code> annotated method signature, though this is rarely needed.</li>
</ol>
<h4 id="state-rebuilding-handler-definition-using-annotations">State Rebuilding Handler Definition using Annotations</h4>
<p><a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/command/StateRebuildingHandlerDefinition.html" title="com.opencqrs.framework.command.StateRebuildingHandlerDefinition" style="color: inherit;"><code>StateRebuildingHandlerDefinition</code></a>s may be defined - even in combination with <code>@Bean</code> definitions -
using the <a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/command/StateRebuilding.html" title="com.opencqrs.framework.command.StateRebuilding" style="color: inherit;"><code>StateRebuilding</code></a> annotation on any suitable state rebuilding method. This greatly
simplifies the definition, since developers are relieved from explicitly instantiating <a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/command/StateRebuildingHandlerDefinition.html" title="com.opencqrs.framework.command.StateRebuildingHandlerDefinition" style="color: inherit;"><code>StateRebuildingHandlerDefinition</code></a>
and choosing a proper <a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/command/StateRebuildingHandler.html" title="com.opencqrs.framework.command.StateRebuildingHandler" style="color: inherit;"><code>StateRebuildingHandler</code></a> subtype, as shown in the following example:</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="nd">@CommandHandlerConfiguration</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BookHandlers</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">      </span><span class="nd">@StateRebuilding</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">      </span><span class="kd">public</span><span class="w"> </span><span class="n">Book</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="n">BookPurchasedEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="cm">/* (1)! */</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Book</span><span class="p">(</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">                    </span><span class="n">event</span><span class="p">.</span><span class="na">isbn</span><span class="p">(),</span><span class="w"> </span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">                    </span><span class="n">event</span><span class="p">.</span><span class="na">numPages</span><span class="p">(),</span><span class="w"> </span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">                    </span><span class="n">Set</span><span class="p">.</span><span class="na">of</span><span class="p">(),</span><span class="w"> </span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">                    </span><span class="kc">null</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w">            </span><span class="p">);</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="p">}</span>
</span></code></pre></div>
<ol>
<li>No previous <code>book</code> state is injected in this example, as <code>BookPurchasedEvent</code> represents the initial event, therefore the state is <code>null</code>.</li>
</ol>
<p>The following rules apply with respect to <a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/command/StateRebuilding.html" title="com.opencqrs.framework.command.StateRebuilding" style="color: inherit;"><code>StateRebuilding</code></a> annotated definitions,
enforced by <a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/command/StateRebuildingAnnotationProcessingAutoConfiguration.html" title="com.opencqrs.framework.command.StateRebuildingAnnotationProcessingAutoConfiguration" style="color: inherit;"><code>StateRebuildingAnnotationProcessingAutoConfiguration</code></a> during Spring
context initialization:</p>
<ul>
<li>The method must be defined within a Spring bean with <em>singleton</em> scope.</li>
<li>The method name can be chosen arbitrary.</li>
<li>The method must return a valid write model type inheriting <code>java.lang.Object</code>.</li>
<li>The method arguments can be ordered arbitrarily, as needed.</li>
<li>The method arguments must be non-repeatable and un-ambiguous.</li>
<li>One of the parameters must be the Java object event type, which must differ from the returned write model type.</li>
<li>An optional parameter representing the previous write model state (or <code>null</code>) may be defined.</li>
<li>An optional parameter of type <code>java.util.Map&lt;String, ?&gt;</code> may be defined to access the event meta-data.</li>
<li>An optional parameter of type <code>java.lang.String</code> may be defined to access the event subject.</li>
<li>An optional nullable parameter of type <a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/esdb/client/Event.html" title="com.opencqrs.esdb.client.Event" style="color: inherit;"><code>Event</code></a> may be defined to access the raw event. </li>
<li>Any number of <code>@Autowired</code> annotated parameters may be defined for injection of dependent Spring beans.</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Lazy Resolution of Dependencies</p>
<p>Method parameters annotated with <code>@Autowired</code> are lazily injected upon state reconstruction or event publication. Accordingly, failures to resolve
those dependencies will not occur during Spring context initialization but when actually executing commands for the first time, resulting
in a <a target="_blank" href="https://docs.opencqrs.com/javadoc/com/opencqrs/framework/CqrsFrameworkException.NonTransientException.html" title="com.opencqrs.framework.CqrsFrameworkException.NonTransientException" style="color: inherit;"><code>NonTransientException</code></a>.</p>
</div>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../command_handler/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Defining Command Handlers">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Defining Command Handlers
              </div>
            </div>
          </a>
        
        
          
          <a href="../event_handler/" class="md-footer__link md-footer__link--next" aria-label="Next: Defining Event Handlers">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Defining Event Handlers
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="mailto:opencqrs@digitalfrontiers.de" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l217.6 163.2c11.4 8.5 27 8.5 38.4 0l217.6-163.2c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48zM0 176v208c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V176L294.4 339.2a63.9 63.9 0 0 1-76.8 0z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://blog.digitalfrontiers.de" target="_blank" rel="noopener" title="blog.digitalfrontiers.de" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M192 32c0 17.7 14.3 32 32 32 123.7 0 224 100.3 224 224 0 17.7 14.3 32 32 32s32-14.3 32-32C512 128.9 383.1 0 224 0c-17.7 0-32 14.3-32 32m0 96c0 17.7 14.3 32 32 32 70.7 0 128 57.3 128 128 0 17.7 14.3 32 32 32s32-14.3 32-32c0-106-86-192-192-192-17.7 0-32 14.3-32 32m-96 16c0-26.5-21.5-48-48-48S0 117.5 0 144v224c0 79.5 64.5 144 144 144s144-64.5 144-144-64.5-144-144-144h-16v96h16c26.5 0 48 21.5 48 48s-21.5 48-48 48-48-21.5-48-48z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/company/digital-frontiers-gmbh-co-kg" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.digitalfrontiers.de" target="_blank" rel="noopener" title="www.digitalfrontiers.de" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M352 256c0 22.2-1.2 43.6-3.3 64H163.4c-2.2-20.4-3.3-41.8-3.3-64s1.2-43.6 3.3-64h185.3c2.2 20.4 3.3 41.8 3.3 64m28.8-64h123.1c5.3 20.5 8.1 41.9 8.1 64s-2.8 43.5-8.1 64H380.8c2.1-20.6 3.2-42 3.2-64s-1.1-43.4-3.2-64m112.6-32H376.7c-10-63.9-29.8-117.4-55.3-151.6 78.3 20.7 142 77.5 171.9 151.6zm-149.1 0H167.7c6.1-36.4 15.5-68.6 27-94.7 10.5-23.6 22.2-40.7 33.5-51.5C239.4 3.2 248.7 0 256 0s16.6 3.2 27.8 13.8c11.3 10.8 23 27.9 33.5 51.5 11.6 26 20.9 58.2 27 94.7m-209 0H18.6c30-74.1 93.6-130.9 172-151.6-25.5 34.2-45.3 87.7-55.3 151.6M8.1 192h123.1c-2.1 20.6-3.2 42-3.2 64s1.1 43.4 3.2 64H8.1C2.8 299.5 0 278.1 0 256s2.8-43.5 8.1-64m186.6 254.6c-11.6-26-20.9-58.2-27-94.6h176.6c-6.1 36.4-15.5 68.6-27 94.6-10.5 23.6-22.2 40.7-33.5 51.5-11.2 10.7-20.5 13.9-27.8 13.9s-16.6-3.2-27.8-13.8c-11.3-10.8-23-27.9-33.5-51.5zM135.3 352c10 63.9 29.8 117.4 55.3 151.6-78.4-20.7-142-77.5-172-151.6zm358.1 0c-30 74.1-93.6 130.9-171.9 151.6 25.5-34.2 45.2-87.7 55.3-151.6h116.7z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.footer", "navigation.tabs", "navigation.indexes", "content.code.copy", "content.code.annotate"], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.f1b6f286.min.js"></script>
      
        <script src="../../../js/open_external_in_new_tab.js"></script>
      
    
  </body>
</html>